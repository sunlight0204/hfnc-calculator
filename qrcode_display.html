<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HFNCå‹åŠ›è®¡ç®—å™¨ - äºŒç»´ç </title>
    <!-- ä½¿ç”¨å¤šä¸ªäºŒç»´ç åº“ï¼Œæé«˜å…¼å®¹æ€§ -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .qrcode-wrapper {
            background: white;
            padding: 40px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
            min-width: 500px;
            min-height: 500px;
        }
        
        #qrcode {
            display: inline-block;
            position: relative;
        }
        
        #qrcode canvas,
        #qrcode img {
            max-width: 100%;
            height: auto;
            border: 8px solid #fff;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }
        
        .download-btn {
            margin-top: 20px;
            padding: 12px 24px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .download-btn:hover {
            background: #45a049;
        }
        
        .qrcode-options {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 12px;
            text-align: left;
        }
        
        .qrcode-options label {
            display: block;
            margin: 10px 0 5px 0;
            font-weight: 600;
            color: #333;
        }
        
        .qrcode-options input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        
        .qrcode-options .value-display {
            color: #667eea;
            font-weight: 600;
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .success-message {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 12px;
        }
        
        .url-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 12px;
            color: #666;
            word-break: break-all;
        }
        
        .instructions {
            margin-top: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
            font-size: 13px;
            color: #1976d2;
            text-align: left;
            line-height: 1.8;
        }
        
        .instructions strong {
            display: block;
            margin-bottom: 8px;
            color: #1565c0;
        }
        
        .link-button {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: transform 0.3s;
        }
        
        .link-button:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HFNCå‹åŠ›è®¡ç®—å™¨</h1>
        <p class="subtitle">é«˜æµé‡é¼»å¯¼ç®¡æ°§ç–—æ°”é“å‹åŠ›é¢„æµ‹è®¡ç®—å™¨<br>ä½¿ç”¨å¾®ä¿¡æ‰«æäºŒç»´ç ï¼Œå¿«é€Ÿè®¿é—®</p>
        
        <div class="qrcode-wrapper">
            <div id="qrcode"></div>
        </div>
        
        <button class="download-btn" onclick="downloadQRCode()">ğŸ“¥ ä¸‹è½½äºŒç»´ç å›¾ç‰‡</button>
        
        <div id="status-message"></div>
        
        <div class="qrcode-options">
            <strong>äºŒç»´ç ä¼˜åŒ–é€‰é¡¹ï¼š</strong>
            <label>
                å°ºå¯¸: <span class="value-display" id="size-value">500</span>px
                <input type="range" id="size-slider" min="300" max="800" value="500" oninput="updateQRCode()">
            </label>
            <label>
                çº é”™çº§åˆ«: <span class="value-display" id="level-value">H (æœ€é«˜)</span>
                <select id="level-select" onchange="updateQRCode()">
                    <option value="L">L (ä½ - 7%)</option>
                    <option value="M">M (ä¸­ - 15%)</option>
                    <option value="Q">Q (é«˜ - 25%)</option>
                    <option value="H" selected>H (æœ€é«˜ - 30%)</option>
                </select>
            </label>
            <button onclick="regenerateQRCode()" style="margin-top: 10px; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                ğŸ”„ é‡æ–°ç”Ÿæˆ
            </button>
        </div>
        
        <div class="url-info">
            <strong>è®¿é—®åœ°å€ï¼š</strong><br>
            <span id="url-display">æ­£åœ¨æ£€æµ‹...</span>
        </div>
        
        <a href="#" 
           id="link-button"
           target="_blank" 
           class="link-button">
            ç›´æ¥æ‰“å¼€è®¡ç®—å™¨
        </a>
        
        <div class="instructions">
            <strong>åº”ç”¨è¯´æ˜ï¼š</strong>
            æœ¬è®¡ç®—å™¨ç”¨äºé«˜æµé‡é¼»å¯¼ç®¡æ°§ç–—ï¼ˆHFNCï¼‰æ—¶ï¼Œæ ¹æ®æµ‹å‹ç®¡å‹åŠ›ï¼ˆPAï¼‰å’Œæµé€Ÿï¼ˆFRï¼‰é¢„æµ‹æ°”é“å‹åŠ›ï¼ˆPCï¼‰ã€‚<br><br>
            <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>
            1. ä½¿ç”¨å¾®ä¿¡æ‰«æä¸Šæ–¹äºŒç»´ç <br>
            2. æˆ–ç‚¹å‡»"ç›´æ¥æ‰“å¼€è®¡ç®—å™¨"æŒ‰é’®<br>
            3. äºŒç»´ç å·²ä¼˜åŒ–ï¼Œæ‰«æåå¿«é€Ÿå“åº”<br>
            4. å»ºè®®åœ¨WiFiç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œä½“éªŒæ›´ä½³
        </div>
    </div>
    
    <script>
        // è‡ªåŠ¨æ£€æµ‹å½“å‰URLæˆ–æ‰‹åŠ¨é…ç½®
        // æ”¯æŒå¤šç§éƒ¨ç½²å¹³å°ï¼šNetlifyã€GitHub Pagesã€Vercelç­‰
        let calculatorUrl;
        
        const hostname = window.location.hostname;
        
        if (hostname.includes('netlify.app')) {
            // Netlifyéƒ¨ç½²ï¼šè‡ªåŠ¨æ£€æµ‹
            calculatorUrl = `${window.location.protocol}//${hostname}/index.html`;
            console.log('è‡ªåŠ¨æ£€æµ‹åˆ°Netlify URL:', calculatorUrl);
        } else if (hostname.includes('github.io')) {
            // GitHub Pageséƒ¨ç½²ï¼šè‡ªåŠ¨æ£€æµ‹
            calculatorUrl = `${window.location.protocol}//${hostname}/index.html`;
            console.log('è‡ªåŠ¨æ£€æµ‹åˆ°GitHub Pages URL:', calculatorUrl);
        } else if (hostname.includes('vercel.app')) {
            // Verceléƒ¨ç½²ï¼šè‡ªåŠ¨æ£€æµ‹
            calculatorUrl = `${window.location.protocol}//${hostname}/index.html`;
            console.log('è‡ªåŠ¨æ£€æµ‹åˆ°Vercel URL:', calculatorUrl);
        } else {
            // æ‰‹åŠ¨é…ç½®ï¼ˆå¦‚æœè‡ªåŠ¨æ£€æµ‹å¤±è´¥ï¼Œè¯·ä¿®æ”¹ä¸‹é¢çš„URLï¼‰
            // æ–¹æ¡ˆ1ï¼šGitHub Pagesï¼ˆæ¨èï¼Œå›½å†…å¯è®¿é—®ï¼‰
            // æ ¼å¼ï¼šhttps://ç”¨æˆ·å.github.io/ä»“åº“å/index.html
            // calculatorUrl = 'https://æ‚¨çš„ç”¨æˆ·å.github.io/hfnc-calculator/index.html';
            
            // æ–¹æ¡ˆ2ï¼šNetlifyï¼ˆéœ€è¦VPNï¼‰
            const netlifyProjectName = 'hfnc-pressure'; // è¯·æ ¹æ®æ‚¨çš„å®é™…é¡¹ç›®åç§°ä¿®æ”¹
            calculatorUrl = `https://${netlifyProjectName}.netlify.app/index.html`;
            
            // æ–¹æ¡ˆ3ï¼šVercelï¼ˆå›½å†…è®¿é—®è¾ƒç¨³å®šï¼‰
            // calculatorUrl = 'https://æ‚¨çš„é¡¹ç›®å.vercel.app/index.html';
            
            console.log('ä½¿ç”¨æ‰‹åŠ¨é…ç½®çš„URL:', calculatorUrl);
        }
        
        // æ˜¾ç¤ºURL
        document.getElementById('url-display').textContent = calculatorUrl;
        document.getElementById('link-button').href = calculatorUrl;
        
        // äºŒç»´ç ç”Ÿæˆé…ç½®
        let qrCodeConfig = {
            size: 500,
            level: 'H',
            margin: 4
        };
        
        // ç”Ÿæˆä¼˜åŒ–çš„äºŒç»´ç ï¼ˆé’ˆå¯¹å¾®ä¿¡æ‰«æä¼˜åŒ–ï¼‰
        function generateQRCode() {
            const qrcodeDiv = document.getElementById("qrcode");
            const statusDiv = document.getElementById('status-message');
            
            // æ¸…ç©ºå®¹å™¨
            qrcodeDiv.innerHTML = '';
            
            // è·å–é…ç½®
            const size = qrCodeConfig.size;
            const level = qrCodeConfig.level;
            const margin = qrCodeConfig.margin;
            
            // çº é”™çº§åˆ«æ˜ å°„
            const levelMap = {
                'L': QRCode.CorrectLevel.L,
                'M': QRCode.CorrectLevel.M,
                'Q': QRCode.CorrectLevel.Q,
                'H': QRCode.CorrectLevel.H
            };
            
            try {
                // æ–¹æ³•1ï¼šå°è¯•ä½¿ç”¨ qrcodejs åº“ï¼ˆä¼˜å…ˆï¼‰
                if (typeof QRCode !== 'undefined') {
                    new QRCode(qrcodeDiv, {
                        text: calculatorUrl,
                        width: size,
                        height: size,
                        colorDark: "#000000",  // çº¯é»‘è‰²ï¼Œæœ€é«˜å¯¹æ¯”åº¦
                        colorLight: "#ffffff", // çº¯ç™½è‰²èƒŒæ™¯
                        correctLevel: levelMap[level] || QRCode.CorrectLevel.H,
                        margin: margin,
                        useSVG: false  // ä½¿ç”¨canvasï¼Œå…¼å®¹æ€§æ›´å¥½
                    });
                    
                    // éªŒè¯ç”Ÿæˆç»“æœ
                    setTimeout(function() {
                        const canvas = qrcodeDiv.querySelector('canvas');
                        const img = qrcodeDiv.querySelector('img');
                        if (canvas || img) {
                            statusDiv.innerHTML = '<div class="success-message">âœ… äºŒç»´ç ç”ŸæˆæˆåŠŸï¼å°ºå¯¸: ' + size + 'pxï¼Œçº é”™çº§åˆ«: ' + level + '</div>';
                            statusDiv.className = '';
                            console.log('äºŒç»´ç ç”ŸæˆæˆåŠŸï¼ŒURL:', calculatorUrl);
                        } else {
                            throw new Error('äºŒç»´ç å…ƒç´ æœªç”Ÿæˆ');
                        }
                    }, 200);
                    
                } else {
                    throw new Error('QRCodeåº“æœªåŠ è½½');
                }
                
            } catch (error) {
                console.error('äºŒç»´ç ç”Ÿæˆå¤±è´¥:', error);
                
                // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨åœ¨çº¿APIç”Ÿæˆ
                try {
                    generateQRCodeWithAPI();
                } catch (apiError) {
                    statusDiv.innerHTML = `
                        <div class="error-message">
                            <strong>âŒ äºŒç»´ç ç”Ÿæˆå¤±è´¥</strong><br>
                            é”™è¯¯ä¿¡æ¯ï¼š${error.message}<br><br>
                            <strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>
                            1. è¯·åˆ·æ–°é¡µé¢é‡è¯•<br>
                            2. æˆ–ä½¿ç”¨åœ¨çº¿äºŒç»´ç ç”Ÿæˆå™¨ï¼š<br>
                            <a href="https://www.qrcode-monkey.com/" target="_blank" style="color: #667eea;">
                                QR Code Monkey
                            </a><br>
                            3. ç›´æ¥è®¿é—®ï¼š<a href="${calculatorUrl}" target="_blank" style="color: #667eea;">${calculatorUrl}</a>
                        </div>
                    `;
                    statusDiv.className = 'error-message';
                }
            }
        }
        
        // ä½¿ç”¨åœ¨çº¿APIç”ŸæˆäºŒç»´ç ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
        function generateQRCodeWithAPI() {
            const qrcodeDiv = document.getElementById("qrcode");
            const size = qrCodeConfig.size;
            
            // ä½¿ç”¨åœ¨çº¿APIç”ŸæˆäºŒç»´ç å›¾ç‰‡
            const apiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(calculatorUrl)}&ecc=${qrCodeConfig.level}`;
            
            const img = document.createElement('img');
            img.src = apiUrl;
            img.alt = 'äºŒç»´ç ';
            img.style.width = size + 'px';
            img.style.height = size + 'px';
            img.style.border = '8px solid #fff';
            img.style.borderRadius = '8px';
            img.style.boxShadow = '0 4px 16px rgba(0, 0, 0, 0.15)';
            
            img.onload = function() {
                qrcodeDiv.appendChild(img);
                document.getElementById('status-message').innerHTML = '<div class="success-message">âœ… äºŒç»´ç ç”ŸæˆæˆåŠŸï¼ˆä½¿ç”¨åœ¨çº¿APIï¼‰ï¼</div>';
            };
            
            img.onerror = function() {
                throw new Error('åœ¨çº¿APIç”Ÿæˆå¤±è´¥');
            };
        }
        
        // æ›´æ–°äºŒç»´ç 
        function updateQRCode() {
            const sizeSlider = document.getElementById('size-slider');
            const levelSelect = document.getElementById('level-select');
            const sizeValue = document.getElementById('size-value');
            const levelValue = document.getElementById('level-value');
            
            qrCodeConfig.size = parseInt(sizeSlider.value);
            qrCodeConfig.level = levelSelect.value;
            
            sizeValue.textContent = qrCodeConfig.size;
            
            const levelNames = {
                'L': 'L (ä½ - 7%)',
                'M': 'M (ä¸­ - 15%)',
                'Q': 'Q (é«˜ - 25%)',
                'H': 'H (æœ€é«˜ - 30%)'
            };
            levelValue.textContent = levelNames[qrCodeConfig.level];
            
            generateQRCode();
        }
        
        // é‡æ–°ç”ŸæˆäºŒç»´ç 
        function regenerateQRCode() {
            generateQRCode();
        }
        
        // æµ‹è¯•URLæ˜¯å¦å¯è®¿é—®
        function testUrlAccess() {
            const statusDiv = document.getElementById('status-message');
            
            // ä½¿ç”¨fetchæµ‹è¯•URLï¼ˆæ³¨æ„ï¼šå¯èƒ½å—CORSé™åˆ¶ï¼Œä½†ä¸å½±å“äºŒç»´ç ï¼‰
            fetch(calculatorUrl, { 
                method: 'HEAD',
                mode: 'no-cors'  // é¿å…CORSé—®é¢˜
            })
            .then(() => {
                console.log('URLå¯è®¿é—®');
            })
            .catch((error) => {
                console.warn('URLæµ‹è¯•å¤±è´¥ï¼ˆå¯èƒ½æ˜¯CORSé™åˆ¶ï¼Œä½†ä¸å½±å“ä½¿ç”¨ï¼‰:', error);
                // ä¸æ˜¾ç¤ºé”™è¯¯ï¼Œå› ä¸ºCORSé™åˆ¶ä¸ä»£è¡¨URLä¸å¯ç”¨
            });
            
            // å¤‡ç”¨æµ‹è¯•ï¼šå°è¯•åŠ è½½favicon
            const testImg = new Image();
            testImg.onload = function() {
                console.log('ç½‘ç«™å¯è®¿é—®');
            };
            testImg.onerror = function() {
                console.warn('ç½‘ç«™å¯èƒ½æ— æ³•è®¿é—®ï¼Œè¯·æ£€æŸ¥éƒ¨ç½²çŠ¶æ€');
                // ä¸é˜»æ­¢äºŒç»´ç ç”Ÿæˆï¼Œè®©ç”¨æˆ·è‡ªå·±æµ‹è¯•
            };
            testImg.src = calculatorUrl.replace('/index.html', '/favicon.ico') + '?t=' + Date.now();
        }
        
        // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆåå†ç”ŸæˆäºŒç»´ç 
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                // å»¶è¿Ÿç”Ÿæˆï¼Œç¡®ä¿åº“åŠ è½½å®Œæˆ
                setTimeout(function() {
                    generateQRCode();
                    testUrlAccess();
                }, 300);
            });
        } else {
            setTimeout(function() {
                generateQRCode();
                testUrlAccess();
            }, 300);
        }
        
        // ä¸‹è½½äºŒç»´ç å›¾ç‰‡
        function downloadQRCode() {
            const qrcodeDiv = document.getElementById('qrcode');
            const canvas = qrcodeDiv.querySelector('canvas');
            const img = qrcodeDiv.querySelector('img');
            
            if (canvas) {
                // ä»canvasä¸‹è½½
                const link = document.createElement('a');
                link.download = 'hfnc_calculator_qrcode.png';
                link.href = canvas.toDataURL('image/png', 1.0); // é«˜è´¨é‡
                link.click();
            } else if (img) {
                // ä»imgä¸‹è½½ï¼ˆéœ€è¦å…ˆè½¬æ¢ä¸ºcanvasï¼‰
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.naturalWidth || img.width;
                canvas.height = img.naturalHeight || img.height;
                ctx.drawImage(img, 0, 0);
                
                canvas.toBlob(function(blob) {
                    const link = document.createElement('a');
                    link.download = 'hfnc_calculator_qrcode.png';
                    link.href = URL.createObjectURL(blob);
                    link.click();
                    URL.revokeObjectURL(link.href);
                }, 'image/png', 1.0);
            } else {
                wx.showToast ? wx.showToast({
                    title: 'äºŒç»´ç å°šæœªç”Ÿæˆ',
                    icon: 'none'
                }) : alert('äºŒç»´ç å°šæœªç”Ÿæˆï¼Œè¯·ç¨å€™å†è¯•');
            }
        }
    </script>
</body>
</html>
